LuaForm = require("UI/LuaForm")

-- 菜单类
LuaForm:subType("MenuForm")
local this = MenuForm

-- 字段
this.m_ProcedureMenu = nil

-- 方法
function this:OnStartButtonClick()
    m_ProcedureMenu:StartGame()
end

function this:OnSettingButtonClick()
   UI:OpenUIForm(CS.Game.UIFormId.SettingForm)
end

function this:OnAboutButtonClick()
   UI:OpenUIForm(CS.Game.UIFormId.AboutForm)
end

function this:OnQuitButtonClick()
    local dialogParams = CS.Game.DialogParams()
    dialogParams.Mode = 2
    dialogParams.Title = Localization:GetString("AskQuitGame.Title")
    dialogParams.Message = Localization:GetString("AskQuitGame.Message")
    dialogParams.OnClickConfirm = function()
        GameFramework.GameEntry.Shutdown(GameFramework.ShutdownType.Quit)
    end
    
    UI:OpenDialog(dialogParams)
end

function this:OnInit(userData)
    self.base.OnInit(self, userData)
    startButton = hotfixForm.Components:GetButton(0)
    startButton.onClick:AddListener(self.OnStartButtonClick)
    settingButton = hotfixForm.Components:GetButton(1)
    settingButton.onClick:AddListener(self.OnSettingButtonClick)
    aboutButton = hotfixForm.Components:GetButton(2)
    aboutButton.onClick:AddListener(self.OnAboutButtonClick)
    quitButton = hotfixForm.Components:GetButton(3)
    quitButton.onClick:AddListener(self.OnQuitButtonClick)
    Log.Info("Menu Form Init complete.")
end

function this:OnOpen(userData)
    self.base.OnOpen(userData)
    if userData == nil then
        Log.Error("HotfixUserData is null.")
        return
    end

    m_ProcedureMenu = userData.UserData
    if m_ProcedureMenu == nil then
        Log.Error("ProcedureMenu is invalid when open MenuForm.")
        return
    end
end

function this:OnClose(isShutDown, userData)
    m_ProcedureMenu = nil
    self.base.OnClose(self, isShutDown, userData)
end

return MenuForm